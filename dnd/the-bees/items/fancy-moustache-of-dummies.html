<p>
This fake moustache made of unknown hairs magically attaches to the skin, hide, or scales of the wearer and appears to be a real one by non-magical means of perception even if the wearer would not be able to grow a moustache. Most observers would recognize it as a magical moustache or magically grown moustache if the wearer would not be able to grow a moustache normally. Removing the moustache is painful, causing the wearer 1d4 <a href="https://www.d20pfsrd.com/Gamemastering/combat/#TOC-Nonlethal-Damage">nonlethal damage</a> when removed as a <a href="https://www.d20pfsrd.com/Gamemastering/combat/#TOC-Standard-Actions">standard action</a> or 1d2 <a href="https://www.d20pfsrd.com/Gamemastering/combat/#TOC-Nonlethal-Damage">nonlethal damage</a> when removed as a <a href="https://www.d20pfsrd.com/Gamemastering/combat/#TOC-Move-Actions">move action</a>.
<br><br>
Once per day, as a <a href="https://www.d20pfsrd.com/gamemastering/combat#TOC-Standard-Actions">standard action</a>, the wearer can choose to either change the color of the mustache to any color and shape, <mark>and</mark> the color of their skin, hide, or scales as if using <a href="https://www.d20pfsrd.com/magic/all-spells/c/chameleon-scales/">chameleon scales</a> except the effect lasts as long as the user is wearing the moustache.
<br><br>
At will, the wearer can cast <a href="https://www.d20pfsrd.com/magic/all-spells/g/ghost-sound/">ghost sound</a> (DC 16) as the spell without needing somatic, verbal, or material components. <mark>At will</mark>, the wearer can cast <a href="https://www.d20pfsrd.com/magic/all-spells/v/ventriloquism/">ventriloquism</a> (DC 18) as the spell without needing verbal components or a focus.
<br><br>
At will, as an <a href="https://www.d20pfsrd.com/gamemastering/Combat/#TOC-Immediate-Actions">immediate action</a>, the wearer can choose to make themself <a href="https://www.d20pfsrd.com/gamemastering/conditions#TOC-Blinded">blinded</a> in <mark>an eye</mark> for the remainder of the day. This condition is not removed early if the moustache is taken off before the next day.
<br><br>
Every day, there is a <mark>30%</mark> chance for the moustache to appear as a handlebar moustache and manifest a bronze monocle on the wearer or nearby if the wearer is already wearing something on both eyes. The color of the moustache is either white or black, whichever is closer to the color of the moustache the day before. For the duration of the day, the wearer cannot change the shape of the moustache and can only choose either white or black as the color if changing the color. The wearer can choose to change the color of the monocle as well if changing the color of the moustache, but the material is always bronze. The monocle disappears at the start of the next day unless the next day is also a day when the monocle appears. <mark>While wearing a monocle that has manifested itself in this way, the wearer can cast <a href="https://www.d20pfsrd.com/magic/all-spells/t/true-seeing/">truesight</a> once per day as a swift action except that it only lasts 1 minute.</mark>
<br><br>
<mark>At will, as a standard action, the wearer can attempt a perception check to make the monocle appear if not already manifested. If the check result exceeds DC 5, the wearer can manifest it for up to a minute; if it exceeds DC 10, up to 10 minutes; DC 15, up to 1 hour; DC 20, up to 12 hours + 1 hour for each 5 above DC 20. The duration must be chosen when manifested. It is a full-round action to unsummon the monocle, unless it was manifested by itself in which case it cannot be unsummoned. Once a day, as a standard action, the wearer can attempt a DC 18 Will Save to force the monocle into existence as if summoned by itself with all benefits. On a success, the wearer takes 1d6 Con damage and the monocle appears as normal for the rest of the day. Getting the monocle this way does not change the moustache nor is it subject to the same limitations of color changing.
</mark>
<br><br>
While wearing the monocle, the wearer gains +5 <a href="https://www.d20pfsrd.com/basics-ability-scores/glossary#TOC-Competence-Bonus">competence bonus</a> on <a href="https://www.d20pfsrd.com/skills/knowledge">Knowledge (Nobility)</a> checks and can make up fancy voices and imitate any accent perfectly. 10 times per day, while wearing a monocle with a handlebar moustache, as a swift action, the user can attempt a DC 10 <a href="https://www.d20pfsrd.com/skills/diplomacy/">Diplomacy</a> check to scold someone. If successful, the user can made a single verbal attack as if they had cast <a href="https://www.d20pfsrd.com/magic/all-spells/b/biting-words">biting words</a>.
<br><br>
Wearing the monocle also enhances eyesight. If the user is under the effects of blindness from the moustache, looking through the monocle of the moustache restores sight in the eye that looks through it but still counts as blinded for all purposes. However, being blind in one eye interferes with the wearer's depth perception and they take a -4 penalty on sight-based <a href="https://www.d20pfsrd.com/skills/perception/">Perception</a> checks and -2 penalty on attack rolls. If the user is not blind, looking through the monocle gives the user heightened vison, granting the a <mark>+4</mark> bonus on sight-based <a href="https://www.d20pfsrd.com/skills/perception/">Perception</a> checks and <mark>+2</mark> bonus on attack rolls. If not blind, once per day as a move action, the user can focus on an enemy and attempt DC <mark>10</mark> <a href="https://www.d20pfsrd.com/skills/perception/">Perception</a> check to gain the effects of <a href="https://www.d20pfsrd.com/magic/all-spells/t/true-strike">true strike</a> for their next attack against that enemy.
<br><br>
Using great care, hairs from the moustache can be divided up and given to other individuals. It takes a minute per person to count hairs and divide up the moustache. Any creature with a hair attached do them can communicate with any other creature with a hair attached as if under the effects of <a href="https://www.d20pfsrd.com/magic/all-spells/s/sending/">sending</a>. However, a creature can only receive 1 word per 5 hairs they have (rounded up) each day and only send 1 word per 5 hairs they have (rounded up) each day. The moustache has 600 hairs. Aside from this sending effect, all other benefits of the moustache only manifest for someone with over half of the hairs of the moustache. Anyone wearing even a single hair of the moustache appears as if with a full moustache. Each day, each individual can choose the color and shape of their own moustache.
<br><br>
<mark>
The wearer of over half of the hairs of the moustache can make a DC 18 diplomacy check once per day to restore all uses of sending to everyone. The wearer of any hairs can make a DC 25 diplomacy check once per day to restore their own uses of sending.
</mark>
<mark>
The moustache also grants a particular eloquence with language of any type including the arcane, granting a +1 bonus to Diplomacy, Bluff, and Intimidate. If the wearer of the moustache has the <a href="https://www.d20pfsrd.com/classes/hybrid-classes/Skald/#TOC-Spell-Kenning-Su-">Spell Kenning</a> class feature, they can cast any spells with a verbal component using the spell's normal casting time instead of 1 full-round action.
<br><br>
Similarly, the moustache grants the user ease to the act of speaking itself. If the wearer has any class abilities requiring only sound-based actions, they reduce the action needed to perform the action by one step down to a free action: a one round action is reduced to a full-round action; a full-round action, a standard action; a standard action, a move action; a move action, a swift action; a swift action, a free action. The moustache is so respectful and coniving, it is nearly sentient. Spending 1 hour, the wearer can infuse the moustache with 1 Charisma to bring it to a quasi-sentience. While infused, the wearer takes a -1 penalty to Charisma that cannot be healed. The Charisma can be retrived by spending an hour with the moustache undoing the infusing ritual. At the end, the wearer regains their Charisma given to the moustache.
<br><br>
If infused, the moustache continues any action it was already doing even if the wearer is unable to continue unless the wearer is unable to continue because they ran out of uses of an ability. This consumes uses of the ability if it is a limited ability. This continuation can be applied to any sound-based action so long as it takes a move, swift, or free action or concentration to maintain or repeat. The exception to this is using this moustache's ghost sounds or ventriloquism ability which it can maintain indefinitely and repeatedly.
</mark>
</p>
<div id="coin-div">
</div>
<script src="/js/p5.js"></script>
<script>

/**
 * A coin is basically a d2 used for deciding between two things.
 * The spin_rot value is the angle around the y-axis where PI / 2 is the front_img
 * fully facing the viewer and 3 * PI / 2 is the back_img fully facing the viewer.
 */
class Coin {
    static FRONT_ROT;
    static BACK_ROT;
    static MIN_SPEED;
    static SPEED_MULT = 0.95;

    static setupStatic() {
        Coin.MIN_SPEED = PI / 96;
        Coin.FRONT_ROT = PI / 2;
        Coin.BACK_ROT = 3 * PI / 2;
    }

    constructor(x, y, width, height, front_img, back_img) {
        this.width = width;
        this.height = height;
        this.pos = createVector(x, y);
        this.spin_rot = Coin.FRONT_ROT;
        this.front_img = front_img;
        this.back_img = back_img;
        this.spin_vel = 0;
        this.spin_stop = 0;
    }

    getSpinRot() {
        return this.spin_rot;
    }

    setSpinRot(rot) {
        this.spin_rot = rot;
    }

    setSpinVel(vel) {
        this.spin_vel = vel;
    }

    setSpinStop(stop) {
        this.spin_stop = stop;
    }

    step() {
        this.spin(this.spin_vel);
        if (this.spin_vel > Coin.MIN_SPEED) {
            this.spin_vel *= Coin.SPEED_MULT;
        }
        else if (this.spin_vel != 0) {
            let isFront = this.spin_stop >= Coin.FRONT_ROT &&
                (this.spin_rot >= Coin.FRONT_ROT || this.spin_rot < Coin.BACK_ROT);
            let isBack = this.spin_stop >= Coin.BACK_ROT && 
                (this.spin_rot >= Coin.BACK_ROT || this.spin_rot < Coin.FORNT_ROT);
            let isClose = abs(this.spin_rot - this.spin_stop) < Coin.MIN_SPEED;
            if (isClose && (isFront || isBack)) {
                this.spin_vel = 0;
                this.spin_rot = this.spin_stop;
            }
        }
    }

    spin(rads) {
        this.spin_rot += rads;
        while (this.spin_rot >= TWO_PI) {
            this.spin_rot -= TWO_PI;
        }
        while (this.spin_rot < 0) {
            this.spin_rot += TWO_PI;
        }
    }

    draw() {
        push();
        translate(this.width / 2, this.height / 2);
        scale(abs(sin(this.spin_rot)), 1);
        let hw = this.width / 2;
        let hh = this.height / 2;
        if (this.spin_rot < PI) {
            image(this.front_img, -hw, -hh, this.width, this.height);
        }
        else {
            image(this.back_img, -hw, -hh, this.width, this.height);
        }
        pop();
    }
}

var coin;
var showText = true;
function setup() {
    let canvas = createCanvas(128, 128);
    canvas.parent("coin-div");

    Coin.setupStatic();

    let front = loadImage("assets/monocle-coin-front.png");
    let back = loadImage("assets/monocle-coin-back.png");
    coin = new Coin(0, 0, 128, 128, front, back);
}

function draw() {
    clear();
    coin.step();
    //coin.spin(PI / 128);
    coin.draw();

    if (showText) {
        textAlign(CENTER);
        textSize(24);
        text("Click to spin", 0, 64 - textAscent(), 128, 128);
    }
}

function roll() {
    showText = false;
    // roll dice and determine result
    let rollRes = Math.floor(Math.random() * 100);
    coin.setSpinVel(Math.random() * PI + PI);
    if (rollRes < 30) {
        coin.setSpinStop(Coin.FRONT_ROT);
    }
    else {
        coin.setSpinStop(Coin.BACK_ROT);
    }
}

function mouseClicked() {
    if (mouseX >= 0 && mouseX < width && mouseY >= 0 && mouseY < height) {
        roll();
    }
}

function touchEnded() {
    mouseClicked();
}
</script>
